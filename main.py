from aiogram import Bot, Dispatcher, types, F
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from aiogram_sqlite_storage.sqlitestore import SQLStorage  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º SQLStorage
from aiogram import Router
import asyncio
import logging

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
API_TOKEN = "7557198950:AAEfq3XrNKRO-FUtOcEOKdEMc7IS6tRwdWI"

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å SQLite
my_storage = SQLStorage('/data/fsm_storage.db', serializing_method='pickle')  # –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 'json' –∏–ª–∏ 'pickle'

bot = Bot(token=API_TOKEN)
dp = Dispatcher(storage=my_storage)  # –ü–µ—Ä–µ–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
router = Router()
dp.include_router(router)

logging.basicConfig(level=logging.INFO)

# –°–æ—Å—Ç–æ—è–Ω–∏—è
class Form(StatesGroup):
    choosing_category = State()
    choosing_question = State()

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã
categories = {
    "–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º": ["–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º –∫ –º—ç—Ä—É?"],
    "–°–æ—Ü–≤—ã–ø–ª–∞—Ç—ã –∏ –ª—å–≥–æ—Ç—ã": [
        "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∑–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –°–í–û?",
        "–ö—É–¥–∞ –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –≤—ã–ø–ª–∞—Ç–∞–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –°–í–û?"
    ],
    "–ñ–∞–ª–æ–±—ã –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è": [
        "–ö–∞–∫ –æ—Å—Ç–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É –Ω–∞ —Ä–∞–±–æ—Ç—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏?",
        "–í —Ç–µ—á–µ–Ω–∏–µ –∫–∞–∫–æ–≥–æ —Å—Ä–æ–∫–∞ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∑–∞—è–≤–ª–µ–Ω–∏–µ?",
        "–ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Å –∂–∞–ª–æ–±–æ–π –Ω–∞ –£–ö?"
    ],
    "–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏": [
        "–û—Ç–∫–ª—é—á–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ?",
        "–û—Ç–∫–ª—é—á–∏–ª–∏ –≥–∞–∑?",
        "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ö–æ–ª–æ–¥–Ω–æ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ?",
        "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≥–æ—Ä—è—á–µ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ?"
    ]
}

# –û—Ç–≤–µ—Ç—ã
answers = {
    "–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º –∫ –º—ç—Ä—É?": """–ó–∞–ø–∏—Å—å –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è:
—Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –ø–æ –ø—è—Ç–Ω–∏—Ü—É —Å 09.00 - 18.00 (–ø–µ—Ä–µ—Ä—ã–≤ 13.00 - 14.00)
–ø–æ –∞–¥—Ä–µ—Å—É: –≥. –ï—Å—Å–µ–Ω—Ç—É–∫–∏, —É–ª. –í–æ–∫–∑–∞–ª—å–Ω–∞—è, 3–ê, —Ç–µ–ª. (87934) 6-56-28.
–ó–∞–ø–∏—Å—å –Ω–∞ –ª–∏—á–Ω—ã–π –ø—Ä–∏—ë–º –∫ –ì–ª–∞–≤–µ –≥–æ—Ä–æ–¥–∞ ‚Äî –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø—Ä–∏—ë–º–æ–≤ –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª–µ–π.""",

    "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∑–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –°–í–û?": """–£—á–∞—Å—Ç–Ω–∏–∫–∏ –°–í–û, –ø–æ–ª—É—á–∏–≤—à–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã, –º–æ–≥—É—Ç –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ –º–µ—Å—Ç—É –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞. –ü–µ—Ä–µ—á–µ–Ω—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∫—Ä–∞—è.""",

    "–ö—É–¥–∞ –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –≤—ã–ø–ª–∞—Ç–∞–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –°–í–û?": """–û–±—Ä–∞—Ç–∏—Ç—å—Å—è –º–æ–∂–Ω–æ:
- –ú–∏–Ω—Ç—Ä—É–¥ –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–æ–≥–æ –∫—Ä–∞—è
- –°–æ—Ü–∑–∞—â–∏—Ç–∞ –ø–æ –º–µ—Å—Ç—É –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞
- –°–æ—Ü—Ñ–æ–Ω–¥ –†–§: sfr.gov.ru
- –§–æ–Ω–¥ "–ó–∞—â–∏—Ç–Ω–∏–∫–∏ –û—Ç–µ—á–µ—Å—Ç–≤–∞", –≥. –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å, —É–ª. –õ–µ–Ω–∏–Ω–∞, 474. –¢–µ–ª: 8 (800) 100-58-71""",

    "–ö–∞–∫ –æ—Å—Ç–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É –Ω–∞ —Ä–∞–±–æ—Ç—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏?": """–ù–∞ —Å–∞–π—Ç–µ essentuki.gosuslugi.ru.
–¢–µ–ª. –ø—Ä–∏—ë–º–Ω–æ–π: +7 (87934) 6-08-10.
Email: adm-essentuki@yandex.ru""",

    "–í —Ç–µ—á–µ–Ω–∏–µ –∫–∞–∫–æ–≥–æ —Å—Ä–æ–∫–∞ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∑–∞—è–≤–ª–µ–Ω–∏–µ?": """–°—Ä–æ–∫ ‚Äî 30 –¥–Ω–µ–π —Å–æ –¥–Ω—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
–í –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö ‚Äî –¥–æ 60 –¥–Ω–µ–π —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞.
–°–º. –∑–∞–∫–æ–Ω ‚Ññ59-–§–ó –æ—Ç 02.05.2006.""",

    "–ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Å –∂–∞–ª–æ–±–æ–π –Ω–∞ –£–ö?": """–í –∂–∏–ª–∏—â–Ω—É—é –∏–Ω—Å–ø–µ–∫—Ü–∏—é –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–æ–≥–æ –∫—Ä–∞—è:
–¢–µ–ª. –¥–æ–≤–µ—Ä–∏—è: (8652) 26-99-69
Email: nadzor26@stavregion.ru
–ß–µ—Ä–µ–∑ –ø–æ—Ä—Ç–∞–ª –ì–ò–° –ñ–ö–•""",

    "–û—Ç–∫–ª—é—á–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ?": """–ê–û ¬´–ï—Å—Å–µ–Ω—Ç—É–∫—Å–∫–∞—è —Å–µ—Ç–µ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª:
–¢–µ–ª: 8 (800) 600-55-83
–ï–î–î–°: 112 –∏–ª–∏ (87934) 6-04-00""",

    "–û—Ç–∫–ª—é—á–∏–ª–∏ –≥–∞–∑?": """–ê–û ¬´–ï—Å—Å–µ–Ω—Ç—É–∫–∏–≥–æ—Ä–≥–∞–∑¬ª:
–¢–µ–ª: 7-33-60 –∏–ª–∏ 104 (–º–æ–±.)""",

    "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ö–æ–ª–æ–¥–Ω–æ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ?": """–ï—Å—Å–µ–Ω—Ç—É–∫—Å–∫–∏–π –≤–æ–¥–æ–∫–∞–Ω–∞–ª:
–¢–µ–ª: +7 (879) 346-06-26
–°—Ç–∞–Ω. –ï—Å—Å–µ–Ω—Ç—É–∫—Å–∫–∞—è, —É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 295 ‚Äî (87961) 5-07-89""",

    "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≥–æ—Ä—è—á–µ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ?": """–ê–û ¬´–≠–Ω–µ—Ä–≥–æ—Ä–µ—Å—É—Ä—Å—ã¬ª:
–¢–µ–ª: 8 (87934) 2-91-00
–û–û–û ¬´–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä–æ—Ä—Ç–∞¬ª: 6-54-08
–ò–ª–∏ –≤ —Å–≤–æ—é –£–ö / –¢–°–ñ"""
}

# –ö–æ–º–∞–Ω–¥–∞ /start
@router.message(F.text == "/start")
async def start(message: types.Message, state: FSMContext):
    welcome_text = (
        "–ü—Ä–∏–≤–µ—Ç, —è —á–∞—Ç-–±–æ—Ç –≥–æ—Ä–æ–¥–∞ –ï—Å—Å–µ–Ω—Ç—É–∫–∏!\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –≥–æ—Ä–æ–¥—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:"
    )
    kb = ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text=cat)] for cat in categories.keys()],
        resize_keyboard=True
    )
    await message.answer(welcome_text, reply_markup=kb)
    await state.set_state(Form.choosing_category)

# –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
@router.message(Form.choosing_category)
async def choose_category(message: types.Message, state: FSMContext):
    selected = message.text
    if selected not in categories:
        await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.")
        return

    kb = ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text=q)] for q in categories[selected]] + [[KeyboardButton(text="üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é")]],
        resize_keyboard=True
    )
    await state.update_data(category=selected)
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å:", reply_markup=kb)
    await state.set_state(Form.choosing_question)

# –í—ã–±–æ—Ä –≤–æ–ø—Ä–æ—Å–∞ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
@router.message(Form.choosing_question)
async def answer_question(message: types.Message, state: FSMContext):
    if message.text == "üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é":
        await start(message, state)
        return

    question = message.text
    answer = answers.get(question)

    if not answer:
        await message.answer("–¢–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        return

    await message.answer(f"–û—Ç–≤–µ—Ç:\n{answer}")

    kb = ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text=cat)] for cat in categories.keys()],
        resize_keyboard=True
    )
    await message.answer("–•–æ—Ç–∏—Ç–µ –∑–∞–¥–∞—Ç—å –µ—â—ë –≤–æ–ø—Ä–æ—Å? –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=kb)
    await state.set_state(Form.choosing_category)

# –ó–∞–ø—É—Å–∫
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
